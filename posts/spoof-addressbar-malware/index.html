<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Spoofing the address bar and the SmartScreen/Malware Warning (Edge) | BrokenBrowser - Fun with browser vulnerabilities</title>
<meta name="keywords" content="">
<meta name="description" content="Update: this bug was patched on 2017-03-14 but we found a bypass the same day. Here it is: Bypassing the patch to continue spoofing the address bar and the Malware Warning.
Over the last few months, we’ve seen a proliferation of these tech-support scams where users end up “locked” in their browsers with horrible red-screens and messages like “your computer may be at risk“. This is not new of course, but scammers are using more and more tricks to fool their victims.">
<meta name="author" content="magicmac">
<link rel="canonical" href="/posts/spoof-addressbar-malware/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css" integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Spoofing the address bar and the SmartScreen/Malware Warning (Edge)" />
<meta property="og:description" content="Update: this bug was patched on 2017-03-14 but we found a bypass the same day. Here it is: Bypassing the patch to continue spoofing the address bar and the Malware Warning.
Over the last few months, we’ve seen a proliferation of these tech-support scams where users end up “locked” in their browsers with horrible red-screens and messages like “your computer may be at risk“. This is not new of course, but scammers are using more and more tricks to fool their victims." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/spoof-addressbar-malware/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-12-07T13:34:22-03:00" />
<meta property="article:modified_time" content="2016-12-07T13:34:22-03:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spoofing the address bar and the SmartScreen/Malware Warning (Edge)"/>
<meta name="twitter:description" content="Update: this bug was patched on 2017-03-14 but we found a bypass the same day. Here it is: Bypassing the patch to continue spoofing the address bar and the Malware Warning.
Over the last few months, we’ve seen a proliferation of these tech-support scams where users end up “locked” in their browsers with horrible red-screens and messages like “your computer may be at risk“. This is not new of course, but scammers are using more and more tricks to fool their victims."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/posts/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Spoofing the address bar and the SmartScreen/Malware Warning (Edge)",
      "item": "/posts/spoof-addressbar-malware/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Spoofing the address bar and the SmartScreen/Malware Warning (Edge)",
  "name": "Spoofing the address bar and the SmartScreen\/Malware Warning (Edge)",
  "description": "Update: this bug was patched on 2017-03-14 but we found a bypass the same day. Here it is: Bypassing the patch to continue spoofing the address bar and the Malware Warning.\nOver the last few months, we’ve seen a proliferation of these tech-support scams where users end up “locked” in their browsers with horrible red-screens and messages like “your computer may be at risk“. This is not new of course, but scammers are using more and more tricks to fool their victims.",
  "keywords": [
    
  ],
  "articleBody": "Update: this bug was patched on 2017-03-14 but we found a bypass the same day. Here it is: Bypassing the patch to continue spoofing the address bar and the Malware Warning.\nOver the last few months, we’ve seen a proliferation of these tech-support scams where users end up “locked” in their browsers with horrible red-screens and messages like “your computer may be at risk“. This is not new of course, but scammers are using more and more tricks to fool their victims.\nThey render red warnings or BSODs with fake messages and sometimes they even throw blocking alerts to prevent users from going away. When a user closes the alert box a new one appears, ad infinitum. In fact, the Chrome version that Jérôme Segura sent me was literally freezing the browser by using a continuous history.pushState trick. Bastards.\nJérôme’s sample lead me to read more, and I ended up learning about the SmartScreen on Edge with its protection against drive-by attacks. It’s cool to see it blocking blacklisted URLs. The SmartScreen Demo site is full of samples, and I’ve chosen the malware page.\nIt was correctly blocked. I know that other browsers (at least IE and Chrome) also handle these things, but I was happy to see it working on Edge. However, I was curious about where this warning page was really coming from, because the address bar points to a URL but the content of the page is obviously not coming from that blocked site. Is this an internal resource? Let’s find out! Press F12 on Edge to open DevTools, and type “location” in the console.\nWow! It seems the real URL is not the one that appears in the address bar. DevTools is telling us that we are located (location.href) in ms-appx-web://microsoft.microsoftedge/assets/errorpages/PhishSiteEdge.htm and the visible URL in the address bar comes from the hash? Also, it looks like this internal page is getting some stuff from the location.search property.\nThis seems interesting. Can we write any URL in the address bar just by setting an arbitrary string after the hash? Where is this htm file coming from? The protocols ms-appx: and ms-appx-web: are used in modern Windows Apps to load their internal resources. Let’s quickly go to the Microsoft Edge folder to see if this file exists. Open Task Manager, details, right click on Microsoft Edge and select properties.\nMicrosoft Edge is located in C:\\Windows\\SystemApps\\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\\ and the error pages (as shown in DevTools above) inside the \\Assets\\ErrorPages folder.\nThere are many files to play with, let’s try to load them from Edge using the full ms-appx-web URL, just like this: ms-appx-web://microsoft.microsoftedge/assets/errorpages/PhishSiteEdge.htm\nDamn it! It goes to my default search engine.\nLet’s try another htm file from that folder, the first one of the list is acr_error.htm. ms-appx-web://microsoft.microsoftedge/assets/errorpages/acr_error.htm\nYes! This one loads. It seems to me that Edge is selectively allowing us to load some pages, but not others. What about the next one, BlockSite.htm? ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite.htm\nNegative. In fact, if we create a webpage with a link pointing to that URL, clicking on it does absolutely nothing. No loading. Same with scripting. Silence. We will try using window.open (why? described here in the final thoughts) which comes handy in these cases, because if there is a problem the browser will actually throw an error. What do we prefer, a browser that remains silent when it refuses to do something, or a browser that at least complains and throws an error?\nwindow.open(\"ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite.htm\"); Now we get an access denied! One thing is to have the browser telling us explicitly that there’s a problem (access denied) and a very different thing is a browser that refuses to load a resource. It’s matter of speed: we can now use a try/catch to quickly retry, on the other hand, using a location.href loads nothing which makes us depend on a timeout or an event (onload/onerror) to see what happened. If we wanted to try a million URLs (think fuzzing) it would have been more convenient a try/catch than using handlers/onload.\nAfter several manual tries using window.open we come to the conclusion that Edge happily loads pages like acr_error.htm but will totally refuse to load BlockSite.htm. In fact, changing any character from BlockSite.htm loads a non-existent page but throws no errors. This means that somewhere in the deep ocean of Edge, there’s binary code that compares our URL with “BlockSite.htm”.\nTo be clear, this URL throws ACCESS_DENIED\nms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite.htm\nBut changing any character (the “B” of BlockSite in this case) throws no errors at all.\nms-appx-web://microsoft.microsoftedge/assets/errorpages/ClockSite.htm\nWe know that altering a simple character fools Edge, but the page is not loaded because it does not exist :). How can we change a character making sure the URL is still valid? Encoding! Let’s try to replace the dot from BlockSite.htm with its ASCII code, 2E, just like this: BlockSite**%2E**htm\nwindow.open(\"ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm\"); Yes! Edge allowed us to load the resource now, lets append a hash and URL like this: #http://www.facebook.com\nwindow.open(\"ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm\"+ \"#http://www.facebook.com\"); Pause. Enjoy. Continue. So we can now open a very ugly webpage with a spoofed URL. But BlockSite.htm is getting a couple of arguments (BlockedDomain and Host) from the location.search. Let’s use them! (Note for the XSS Masters Gareth and Mario: can we try something better here?)\nwindow.open(\"ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm?\"+ \"BlockedDomain=facebook.com\u0026Host=Technical Support Really Super Legit CALL NOW\\:\"+ \"800-111-2222#http://www.facebook.com\"); Test the PoC LIVE on Edge Patched on 2017-03-14 – CVE-2017-0154 As a bonus, when we place a telephone-like number, a link is automatically created so the user can call us with a single click. Very convenient for these scammers.\nBug hunter, I will stop here but IMO there are tons of things to research. Are you curious about what other things these internal pages do? We can load them all without restrictions now. For example, needie.html is worth checking (if we can bypass more stuff) because it has the power to run Internet Explorer. It didn’t work for me and it’s clear that it opens a different Edge process which deserves even more research. If you want to see it in action, try opening this page on Edge and see how it works.\nFinally, if you are curious about how the string comparison happens and why it fails, load EdgeHtml.dll in IDA free and analyze the function CURLBlock::s_IsBlockPageUrl. If you prefer live debugging, a breakpoint in EdgeHtml!CURLBlock::s_IsBlockPageUrl will make it.\nHave a nice day!\n@magicmac2000\n",
  "wordCount" : "1056",
  "inLanguage": "en",
  "datePublished": "2016-12-07T13:34:22-03:00",
  "dateModified": "2016-12-07T13:34:22-03:00",
  "author":{
    "@type": "Person",
    "name": "magicmac"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/posts/spoof-addressbar-malware/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "BrokenBrowser - Fun with browser vulnerabilities",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="BrokenBrowser - Fun with browser vulnerabilities (Alt + H)">BrokenBrowser - Fun with browser vulnerabilities</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Spoofing the address bar and the SmartScreen/Malware Warning (Edge)
    </h1>
    <div class="post-meta"><span title='2016-12-07 13:34:22 -0300 -03'>December 7, 2016</span>&nbsp;·&nbsp;magicmac

</div>
  </header> 
  <div class="post-content"><p><strong><!-- raw HTML omitted -->Update<!-- raw HTML omitted --></strong>: this bug was patched on 2017-03-14 but we found a bypass the same day. Here it is: <a href="https://www.brokenbrowser.com/bypass-the-patch-to-keep-spoofing-the-address-bar-with-the-malware-warning/">Bypassing the patch to continue spoofing the address bar and the Malware Warning</a>.</p>
<p>Over the last few months, we’ve seen a proliferation of these tech-support scams where users end up “locked” in their browsers with horrible red-screens and messages like “<em>your computer may be at risk</em>“. This is <a href="https://blog.malwarebytes.com/threat-analysis/2014/08/beware-of-us-based-tech-support-scams/">not new</a> of course, but scammers are using <a href="https://twitter.com/jeromesegura/status/793855666293084160">more</a> and <a href="https://twitter.com/douglasmun/status/803964946044157952">more</a> tricks to fool their victims.</p>
<p><a href="/wp-content/uploads/2016/12/01-scam-tech-support.png" title="Warning Scam"><img loading="lazy" src="/2016/12/01-scam-tech-support.png" alt="01-scam-tech-support"  />
</a>They render red warnings or <a href="https://en.wikipedia.org/wiki/Blue_Screen_of_Death">BSODs</a> with fake messages and sometimes they even throw blocking alerts to prevent users from going away. When a user closes the alert box a new one appears, ad infinitum. In fact, the Chrome version that <a href="https://twitter.com/jeromesegura">Jérôme Segura</a> sent me was literally freezing the browser by using a <a href="https://blog.malwarebytes.com/cybercrime/social-engineering-cybercrime/2016/11/tech-support-scammers-abuse-bug-in-html5-feature-to-freeze-computers/">continuous history.pushState trick</a>. Bastards.</p>
<p>Jérôme’s sample lead me to read more, and I ended up learning about the <a href="https://blogs.windows.com/msedgedev/2015/12/16/smartscreen-drive-by-improvements/">SmartScreen on Edge</a> with its protection against drive-by attacks. It’s cool to see it blocking blacklisted URLs. The <a href="http://demo.smartscreen.msft.net/">SmartScreen Demo</a> site is full of samples, and I’ve chosen the <a href="http://demo.smartscreen.msft.net/other/malware.html">malware page.</a></p>
<p><a href="/wp-content/uploads/2016/12/02-smartscreen-demo-pages.png" title="SmartScreen Demo Pages"><img loading="lazy" src="/2016/12/02-smartscreen-demo-pages.png" alt="Smartscreen Demo Pages"  />
</a>It was correctly blocked. I know that other browsers (at least IE and Chrome) also handle these things, but I was happy to see it working on Edge. However, I was curious about where this warning page was really coming from, because the address bar points to a URL but the content of the page is obviously not coming from that <strong>blocked</strong> site. Is this an internal resource? Let’s find out! Press F12 on Edge to open DevTools, and type “location” in the console.</p>
<p><a href="/wp-content/uploads/2016/12/03-f12-realurl.png" title="DevTools with Real URL"><img loading="lazy" src="/2016/12/03-f12-realurl.png" alt="DevTools Real URL"  />
</a>Wow! It seems the real URL is not the one that appears in the address bar. DevTools is telling us that we are located (location.href) in ms-appx-web://microsoft.microsoftedge/assets/errorpages/PhishSiteEdge.htm and the visible URL in the address bar comes from the hash? Also, it looks like this internal page is getting some stuff from the location.search property.</p>
<p>This seems interesting. Can we write any URL in the address bar just by setting an arbitrary string after the hash? Where is this htm file coming from? The protocols <strong>ms-appx:</strong> and <strong>ms-appx-web:</strong> are used in modern Windows Apps to load their internal resources. Let’s quickly go to the Microsoft Edge folder to see if this file exists. Open Task Manager, details, right click on Microsoft Edge and select properties.</p>
<p><a href="/wp-content/uploads/2016/12/04-edge-location.png" title="Edge Full Path"><img loading="lazy" src="/2016/12/04-edge-location.png" alt="Edge Path"  />
</a>Microsoft Edge is located in C:\Windows\SystemApps\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\ and the error pages (as shown in DevTools above) inside the \Assets\ErrorPages folder.</p>
<p><a href="/wp-content/uploads/2016/12/05-phishsite.png" title="Edge Assets Folder"><img loading="lazy" src="/2016/12/05-phishsite.png" alt="PhishSite"  />
</a>There are many files to play with, let’s try to load them from Edge using the full ms-appx-web URL, just like this: ms-appx-web://microsoft.microsoftedge/assets/errorpages/PhishSiteEdge.htm</p>
<p>Damn it! It goes to my default search engine.<br>
<a href="/wp-content/uploads/2016/12/06-no-load-in-address-bar.png" title="Default Search Engine"><img loading="lazy" src="/2016/12/06-no-load-in-address-bar.png" alt="URL not loading"  />
</a></p>
<p>Let’s try another htm file from that folder, the first one of the list is <strong>acr_error.htm</strong>. ms-appx-web://microsoft.microsoftedge/assets/errorpages/acr_error.htm</p>
<p>Yes! This one loads. It seems to me that Edge is selectively allowing us to load some pages, but not others. What about the next one, BlockSite.htm? ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite.htm</p>
<p>Negative. In fact, if we create a webpage with a link pointing to that URL, clicking on it does absolutely nothing. No loading. Same with scripting. Silence. We will try using window.open (why? <a href="https://www.brokenbrowser.com/detecting-local-files-to-evade-analysts/">described here in the final thoughts</a>) which comes handy in these cases, because if there is a problem the browser will actually throw an error. What do we prefer, a browser that remains silent when it refuses to do something, or a browser that at least complains and throws an error?</p>
<pre tabindex="0"><code>window.open(&#34;ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite.htm&#34;);
</code></pre><p><a href="/wp-content/uploads/2016/12/07-access-denied.png" title="Access Denied"><img loading="lazy" src="/2016/12/07-access-denied.png" alt="Access Denied"  />
</a>Now we get an access denied! One thing is to have the browser telling us explicitly that there’s a problem (access denied) and a very different thing is a browser that refuses to load a resource. It’s matter of speed: we can now use a try/catch to quickly retry, on the other hand, using a location.href loads nothing which makes us depend on a timeout or an event (onload/onerror) to see what happened. If we wanted to try a million URLs (think fuzzing) it would have been more convenient a try/catch than using handlers/onload.</p>
<p>After several manual tries using window.open we come to the conclusion that Edge happily loads pages like <strong>acr_error.htm</strong> but will totally refuse to load <strong>BlockSite.htm</strong>. In fact, changing any character from BlockSite.htm loads a non-existent page but <strong>throws no errors</strong>. This means that somewhere in the deep ocean of Edge, there’s binary code that compares our URL with “BlockSite.htm”.</p>
<p>To be clear, this URL throws ACCESS_DENIED<br>
ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite.htm</p>
<p>But changing any character (the “B” of BlockSite in this case) throws no errors at all.<br>
ms-appx-web://microsoft.microsoftedge/assets/errorpages/<strong>C</strong>lockSite.htm</p>
<p>We know that altering a simple character fools Edge, but the page is not loaded because it does not exist :). How can we change a character making sure the URL is still valid? Encoding! Let’s try to replace the dot from BlockSite.htm with its ASCII code, 2E, just like this: BlockSite**%2E**htm</p>
<pre tabindex="0"><code>window.open(&#34;ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm&#34;);
</code></pre><p>Yes! Edge allowed us to load the resource now, lets append a hash and URL like this: <strong>#http://www.facebook.com</strong></p>
<pre tabindex="0"><code>window.open(&#34;ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm&#34;+
&#34;#http://www.facebook.com&#34;);
</code></pre><p><a href="/wp-content/uploads/2016/12/08-fb.png" title="Facebook Spoof"><img loading="lazy" src="/2016/12/08-fb.png" alt="Facebook Spoofed"  />
</a>Pause. Enjoy. Continue. So we can now open a very ugly webpage with a spoofed URL. But BlockSite.htm is getting a couple of arguments (BlockedDomain and Host) from the location.search. Let’s use them! (Note for the XSS Masters <a href="https://twitter.com/garethheyes">Gareth</a> and <a href="https://twitter.com/0x6D6172696F">Mario</a>: can we try something better here?)</p>
<pre tabindex="0"><code>window.open(&#34;ms-appx-web://microsoft.microsoftedge/assets/errorpages/BlockSite%2ehtm?&#34;+
&#34;BlockedDomain=facebook.com&amp;Host=Technical Support Really Super Legit CALL NOW\:&#34;+
&#34;800-111-2222#http://www.facebook.com&#34;);
</code></pre><h2 id="facebook-scam20161209-fbpngwp-contentuploads20161209-fbpng-facebook-malwaretest-the-poc-live-on-edgehttpswwwcrackingcomardemosedgesmartscreen"><a href="/wp-content/uploads/2016/12/09-fb.png" title="Facebook Malware"><img loading="lazy" src="/2016/12/09-fb.png" alt="Facebook Scam"  />
</a><a href="https://www.cracking.com.ar/demos/edgesmartscreen/">Test the PoC LIVE on Edge</a></h2>
<h3 id="patched-on-2017-03-14httpstechnetmicrosoftcomlibrarysecurityms17-006--cve-2017-0154httpwwwcvemitreorgcgi-bincvenamecginamecve-2017-0154"><a href="https://technet.microsoft.com/library/security/MS17-006">Patched on 2017-03-14</a> – <a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0154">CVE-2017-0154</a><a hidden class="anchor" aria-hidden="true" href="#patched-on-2017-03-14httpstechnetmicrosoftcomlibrarysecurityms17-006--cve-2017-0154httpwwwcvemitreorgcgi-bincvenamecginamecve-2017-0154">#</a></h3>
<p>As a bonus, when we place a telephone-like number, a link is automatically created so the user can call us with a single click. Very convenient for these scammers.</p>
<p>Bug hunter, I will stop here but IMO there are tons of things to research. Are you curious about what other things these internal pages do? We can load them all without restrictions now. For example, needie.html is worth checking (if we can bypass more stuff) because it has the power to run Internet Explorer. It didn’t work for me and it’s clear that it opens a different Edge process which deserves even more research. If you want to see it in action, <a href="https://redmondts.microsoft.com/">try opening this page on Edge</a> and see how it works.</p>
<p>Finally, if you are curious about how the string comparison happens and why it fails, <a href="http://pastebin.com/U3GqV3SV">load EdgeHtml.dll in IDA free</a> and analyze the function <strong>CURLBlock::s_IsBlockPageUrl</strong>. If you prefer live debugging, a breakpoint in <strong>EdgeHtml!CURLBlock::s_IsBlockPageUrl</strong> will make it.</p>
<p>Have a nice day!<br>
<a href="https://twitter.com/magicmac2000">@magicmac2000</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="/">BrokenBrowser - Fun with browser vulnerabilities</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
